"use client";

import { useRouter } from "next/navigation";
import { useAuthStore } from "@/modules/auth/store/auth.store";
import { useWorkspaces, useWorkspaceInvites } from "@/modules/workspace/hooks";
import { usePersonStats } from "@/modules/person/hooks/usePersonQueries";
import { useWorkspaceStore } from "@/modules/workspace/store/workspace.store";
import { useThemeStore } from "@/store/theme.store";
import { WorkspaceSwitcher } from "@/modules/workspace/components/WorkspaceSwitcher";
import { NotificationBell } from "@/components/NotificationBell";
import { WalletDisplay } from "@/components/WalletDisplay";
import { UserMenu } from "@/components/UserMenu";

export default function DashboardPage() {
  const router = useRouter();
  const { user } = useAuthStore();
  const { activeWorkspace } = useWorkspaceStore();
  const { theme } = useThemeStore();

  // Pr√©-carregar workspaces e convites
  useWorkspaces();
  useWorkspaceInvites();

  // Carregar estat√≠sticas de pessoas
  const { data: personStats } = usePersonStats(activeWorkspace?.id || "");

  // Theme colors
  const colors = {
    light: {
      bg: "#f6f8fa",
      card: "white",
      border: "#d0d7de",
      text: "#24292f",
      textSecondary: "#57606a",
      hover: "#0969da",
      badgeBg: "#ddf4ff",
      badgeText: "#0969da",
      badgeBorder: "#54aeff",
    },
    dark: {
      bg: "#0d1117",
      card: "#161b22",
      border: "#30363d",
      text: "#f0f6fc",
      textSecondary: "#8b949e",
      hover: "#58a6ff",
      badgeBg: "#1f6feb",
      badgeText: "#58a6ff",
      badgeBorder: "#1f6feb",
    },
  };

  const c = colors[theme];

  return (
    <div className="min-h-screen" style={{ backgroundColor: c.bg }}>
      {/* Header estilo GitHub */}
      <header style={{ backgroundColor: c.card, borderBottom: `1px solid ${c.border}` }}>
        <div className="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
          <div className="flex items-center gap-4">
            <h1 className="text-xl font-semibold" style={{ color: c.text }}>
              Cortex Control
            </h1>
            <WorkspaceSwitcher />
          </div>
          <div className="flex items-center gap-3">
            <NotificationBell />
            <WalletDisplay />
            <UserMenu />
          </div>
        </div>
      </header>

      {/* Content */}
      <div className="max-w-7xl mx-auto px-6 py-8">
        {/* Page Header */}
        <div className="mb-8">
          <h2 className="text-2xl font-semibold mb-2" style={{ color: c.text }}>
            Dashboard
          </h2>
          <p style={{ color: c.textSecondary }}>Bem-vindo ao seu painel de controle</p>
        </div>

        {/* Stats Grid - estilo GitHub */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
          {/* Card Pessoas */}
          <button
            onClick={() => router.push("/persons")}
            className="rounded-md p-5 transition-all text-left group"
            style={{ 
              backgroundColor: c.card, 
              border: `1px solid ${c.border}`,
            }}
            onMouseEnter={(e) => e.currentTarget.style.borderColor = c.hover}
            onMouseLeave={(e) => e.currentTarget.style.borderColor = c.border}
          >
            <div className="flex items-start justify-between mb-3">
              <div>
                <h3 className="text-sm font-medium mb-1" style={{ color: c.textSecondary }}>
                  Pessoas
                </h3>
                {personStats ? (
                  <p className="text-2xl font-semibold" style={{ color: c.text }}>
                    {personStats.total}
                  </p>
                ) : (
                  <p className="text-2xl font-semibold" style={{ color: c.textSecondary }}>-</p>
                )}
              </div>
              <span className="text-2xl opacity-70 group-hover:opacity-100 transition-opacity">
                üë•
              </span>
            </div>
            {personStats && (
              <div className="space-y-1 text-xs" style={{ color: c.textSecondary }}>
                <div className="flex justify-between py-1" style={{ borderTop: `1px solid ${c.border}` }}>
                  <span>Leads</span>
                  <span className="font-medium" style={{ color: c.text }}>
                    {personStats.byType.lead || 0}
                  </span>
                </div>
                <div className="flex justify-between py-1">
                  <span>Clientes</span>
                  <span className="font-medium" style={{ color: c.text }}>
                    {personStats.byType.customer || 0}
                  </span>
                </div>
                <div className="flex justify-between py-1">
                  <span>Empresas</span>
                  <span className="font-medium" style={{ color: c.text }}>
                    {personStats.byType.company || 0}
                  </span>
                </div>
                <div className="flex justify-between py-1">
                  <span>Fornecedores</span>
                  <span className="font-medium" style={{ color: c.text }}>
                    {personStats.byType.supplier || 0}
                  </span>
                </div>
              </div>
            )}
          </button>

          {/* Card Workspaces */}
          <button
            onClick={() => router.push("/workspaces")}
            className="rounded-md p-5 transition-all text-left group"
            style={{ 
              backgroundColor: c.card, 
              border: `1px solid ${c.border}`,
            }}
            onMouseEnter={(e) => e.currentTarget.style.borderColor = c.hover}
            onMouseLeave={(e) => e.currentTarget.style.borderColor = c.border}
          >
            <div className="flex items-start justify-between mb-3">
              <div>
                <h3 className="text-sm font-medium mb-1" style={{ color: c.textSecondary }}>
                  Workspaces
                </h3>
                <p className="text-sm mt-2" style={{ color: c.textSecondary }}>
                  Gerencie seus espa√ßos de trabalho
                </p>
              </div>
              <span className="text-2xl opacity-70 group-hover:opacity-100 transition-opacity">
                üè¢
              </span>
            </div>
          </button>

          {/* Card Perfil */}
          <button
            onClick={() => router.push("/profile")}
            className="rounded-md p-5 transition-all text-left group"
            style={{ 
              backgroundColor: c.card, 
              border: `1px solid ${c.border}`,
            }}
            onMouseEnter={(e) => e.currentTarget.style.borderColor = c.hover}
            onMouseLeave={(e) => e.currentTarget.style.borderColor = c.border}
          >
            <div className="flex items-start justify-between mb-3">
              <div>
                <h3 className="text-sm font-medium mb-1" style={{ color: c.textSecondary }}>
                  Perfil
                </h3>
                <p className="text-sm mt-2" style={{ color: c.textSecondary }}>
                  Configura√ß√µes e prefer√™ncias
                </p>
              </div>
              <span className="text-2xl opacity-70 group-hover:opacity-100 transition-opacity">
                ‚öôÔ∏è
              </span>
            </div>
          </button>
        </div>

        {/* User Info Card - estilo GitHub */}
        <div className="rounded-md" style={{ backgroundColor: c.card, border: `1px solid ${c.border}` }}>
          <div className="px-5 py-4" style={{ borderBottom: `1px solid ${c.border}` }}>
            <h3 className="text-sm font-semibold" style={{ color: c.text }}>
              Informa√ß√µes da Conta
            </h3>
          </div>
          <div className="p-5">
            <dl className="space-y-4">
              <div className="flex items-start">
                <dt className="text-sm w-32" style={{ color: c.textSecondary }}>Nome</dt>
                <dd className="text-sm flex-1" style={{ color: c.text }}>{user?.name}</dd>
              </div>
              <div className="flex items-start">
                <dt className="text-sm w-32" style={{ color: c.textSecondary }}>Email</dt>
                <dd className="text-sm flex-1" style={{ color: c.text }}>{user?.email}</dd>
              </div>
              <div className="flex items-start">
                <dt className="text-sm w-32" style={{ color: c.textSecondary }}>Role</dt>
                <dd className="text-sm flex-1">
                  <span 
                    className="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium"
                    style={{ 
                      backgroundColor: theme === "light" ? c.badgeBg : `${c.badgeBg}1a`,
                      color: c.badgeText,
                      border: `1px solid ${c.badgeBorder}30`
                    }}
                  >
                    {user?.role}
                  </span>
                </dd>
              </div>
              <div className="flex items-start">
                <dt className="text-sm w-32" style={{ color: c.textSecondary }}>Provider</dt>
                <dd className="text-sm flex-1" style={{ color: c.text }}>
                  {user?.provider || "local"}
                </dd>
              </div>
              {activeWorkspace && (
                <div className="flex items-start">
                  <dt className="text-sm w-32" style={{ color: c.textSecondary }}>Workspace</dt>
                  <dd className="text-sm flex-1" style={{ color: c.text }}>
                    {activeWorkspace.name}
                  </dd>
                </div>
              )}
            </dl>
          </div>
        </div>
      </div>
    </div>
  );
}
